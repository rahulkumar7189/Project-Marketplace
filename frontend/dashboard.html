<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard | AcadMate</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body>
    <header>
        <div class="container">
            <nav>
                <a href="index.html" class="logo">
                    <i class="fas fa-graduation-cap"></i> AcadMate
                </a>
                <div class="nav-links">
                    <span id="userName" style="font-weight: 600; color: var(--primary);"></span>
                    <div style="display: flex; gap: 1rem; align-items: center; margin-right: 1rem;">
                        <button onclick="showChatList()" class="nav-icon-btn" title="Chats">
                            <i class="fas fa-comment-alt"></i>
                            <span id="chatBadge" class="nav-badge" style="display: none;"></span>
                        </button>
                        <button class="nav-icon-btn" title="Notifications">
                            <i class="fas fa-bell"></i>
                            <span id="notifBadge" class="nav-badge" style="display: none;"></span>
                        </button>
                    </div>
                    <button onclick="logout()" class="btn btn-outline" style="padding: 0.4rem 1rem;">Logout</button>
                </div>
            </nav>
        </div>
    </header>

    <main class="container" style="padding-top: 120px;">
        <!-- Student Dashboard -->
        <div id="studentDashboard" style="display: none;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                <h2>My Help Requests</h2>
                <button onclick="showRequestModal()" class="btn btn-primary">Post New Request</button>
            </div>
            <div id="studentRequests" class="feature-grid">
                <!-- Requests will be injected here -->
            </div>
            <div style="margin-top: 4rem;">
                <h2>Booking History</h2>
                <div id="studentHistory" class="feature-grid" style="grid-template-columns: 1fr;">
                    <!-- History will be injected here -->
                </div>
            </div>
        </div>

        <!-- Helper Dashboard -->
        <div id="helperDashboard" style="display: none;">
            <div style="margin-bottom: 2rem;">
                <h2>Available Requests</h2>
                <div style="margin-top: 1rem;">
                    <input type="text" id="subjectFilter" class="form-input" placeholder="Filter by subject..."
                        style="max-width: 300px;">
                </div>
            </div>
            <div id="availableRequests" class="feature-grid">
                <!-- Available requests will be injected here -->
            </div>
            <div style="margin-top: 4rem;">
                <h2>My History</h2>
                <div id="helperHistory" class="feature-grid" style="grid-template-columns: 1fr;">
                    <!-- History will be injected here -->
                </div>
            </div>
        </div>
    </main>

    <!-- Request Modal -->
    <div id="requestModal" class="modal-overlay">
        <div class="auth-card" style="max-width: 600px;">
            <h3>Post a New Request</h3>
            <form id="requestForm">
                <div class="form-group">
                    <label>Title</label>
                    <input type="text" id="reqTitle" class="form-input" required>
                </div>
                <div class="form-group">
                    <label>Subject</label>
                    <input type="text" id="reqSubject" class="form-input" required>
                </div>
                <div class="form-group">
                    <label>Description</label>
                    <textarea id="reqDesc" class="form-input" style="height: 100px;" required></textarea>
                </div>
                <div class="form-group">
                    <label>Deadline</label>
                    <input type="datetime-local" id="reqDeadline" class="form-input" required>
                </div>
                <div class="form-group">
                    <label>Attachments (PDF, Images, Docs)</label>
                    <input type="file" id="reqFiles" class="form-input" multiple>
                    <small style="color: var(--secondary);">You can upload multiple files.</small>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">Submit Request</button>
                <button type="button" onclick="hideRequestModal()" class="btn btn-outline"
                    style="width: 100%; margin-top: 1rem;">Cancel</button>
            </form>
        </div>
    </div>

    <!-- Chat List Modal -->
    <div id="chatListModal" class="modal-overlay">
        <div class="auth-card" style="max-width: 500px; width: 90%; max-height: 80vh; overflow-y: auto;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                <h3><i class="fas fa-comments"></i> All Chats</h3>
                <button onclick="hideChatList()" class="btn btn-outline"
                    style="padding: 0.2rem 0.5rem;">&times;</button>
            </div>
            <div id="chatListContent">
                <!-- Chat items will be injected here -->
                <p style="color: var(--secondary); text-align: center;">No active chats found.</p>
            </div>
        </div>
    </div>

    <!-- Chat Modal -->
    <div id="chatModal" class="modal-overlay">
        <div class="auth-card"
            style="max-width: 800px; width: 90%; height: 80vh; display: flex; flex-direction: column;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                <h3 id="chatTitle">Chat</h3>
                <button onclick="hideChatModal()" class="btn btn-outline"
                    style="padding: 0.2rem 0.5rem;">&times;</button>
            </div>
            <div id="messageList"
                style="flex: 1; overflow-y: auto; border: 1px solid var(--border); border-radius: 8px; padding: 1rem; margin-bottom: 1rem; background: #fff;">
                <!-- Messages will be injected here -->
            </div>
            <form id="chatForm" style="display: flex; gap: 0.5rem;">
                <input type="text" id="chatInput" class="form-input" placeholder="Type your message..." required>
                <button type="submit" class="btn btn-primary">Send</button>
            </form>
        </div>
    </div>

    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/dashboard.js"></script>
</body>

</html>